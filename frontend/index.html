<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PIOERP — Gestão de Estoque de T.I.</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<!-- ═══════════════════════════════════════════════════════
     APP SHELL
══════════════════════════════════════════════════════════ -->
<div id="app">

  <!-- ── SIDEBAR ── -->
  <aside id="sidebar">
    <div class="sidebar-brand">
      <div class="brand-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="3" width="20" height="14" rx="2"/>
          <path d="M8 21h8M12 17v4"/>
          <path d="M6 8h4M6 11h4M14 8h4M14 11h2"/>
        </svg>
      </div>
      <div class="brand-text">
        <span class="brand-name">PIOERP</span>
        <span class="brand-sub">Gestão de T.I.</span>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-group">
        <span class="nav-label">Principal</span>
        <a href="#" class="nav-item active" data-section="dashboard">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
          Dashboard
        </a>
      </div>

      <div class="nav-group">
        <span class="nav-label">Cadastros</span>
        <a href="#" class="nav-item" data-section="catalogo">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
          Catálogo
        </a>
        <a href="#" class="nav-item" data-section="enderecos">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
          Endereços WMS
        </a>

        <a href="#" class="nav-item" data-section="wms-mapa">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
          Porta-Pallet
        </a>
      </div>

      <div class="nav-group">
        <span class="nav-label">Movimentações</span>
        <a href="#" class="nav-item" data-section="equipamentos">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
          Equipamentos
        </a>
        <a href="#" class="nav-item" data-section="entrada">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
          Entrada
        </a>
        <a href="#" class="nav-item" data-section="saida">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          Saída / Movimentar
        </a>
      </div>

      <div class="nav-group">
        <span class="nav-label">Recebimento</span>
        <a href="#" class="nav-item" data-section="recebimento">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          Recebimento
          <span class="nav-badge" id="badge-recebimento" style="display:none">0</span>
        </a>
        <a href="#" class="nav-item" data-section="solicitacoes">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
          Solicitações Almox.
          <span class="nav-badge nav-badge-danger" id="badge-solicitacoes" style="display:none">0</span>
        </a>
      </div>

      <div class="nav-group">
        <span class="nav-label">Manutenção</span>
        <a href="#" class="nav-item" data-section="reparo">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
          Central de Reparo
          <span class="nav-badge" id="badge-reparo" style="display:none">0</span>
        </a>
        <a href="#" class="nav-item" data-section="internalizacao">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><polyline points="9 12 11 14 15 10"/></svg>
          Internalização
          <span class="nav-badge nav-badge-danger" id="badge-internalizacao" style="display:none">0</span>
        </a>
      </div>
    </nav>

    <div class="sidebar-footer">
      <span>v1.0.0 — 2025</span>
    </div>
  </aside>

  <!-- ── MAIN ── -->
  <div id="main">

    <!-- Top bar -->
    <header id="topbar">
      <button id="sidebar-toggle" class="icon-btn" title="Recolher menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
      <div class="topbar-title">
        <h2 id="page-title">Dashboard</h2>
      </div>
      <div class="topbar-actions">
        <button class="btn btn-sm btn-outline" onclick="App.refresh()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-.08-1"/></svg>
          Atualizar
        </button>
      </div>
    </header>

    <!-- ─────────────────────────────────────────────────
         SECTION: DASHBOARD
    ───────────────────────────────────────────────── -->
    <section id="section-dashboard" class="page-section active">
      <div class="kpi-grid" id="kpi-cards">
        <div class="kpi-card kpi-blue">
          <div class="kpi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg></div>
          <div class="kpi-body"><span class="kpi-value" id="kpi-total">—</span><span class="kpi-label">Total Equipamentos</span></div>
        </div>
        <div class="kpi-card kpi-green">
          <div class="kpi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="kpi-body"><span class="kpi-value" id="kpi-reposicao">—</span><span class="kpi-label">Em Reposição</span></div>
        </div>
        <div class="kpi-card kpi-yellow">
          <div class="kpi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg></div>
          <div class="kpi-body"><span class="kpi-value" id="kpi-triagem">—</span><span class="kpi-label">Ag. Triagem</span></div>
        </div>
        <div class="kpi-card kpi-red">
          <div class="kpi-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
          <div class="kpi-body"><span class="kpi-value" id="kpi-alertas">—</span><span class="kpi-label">Alertas Críticos</span></div>
        </div>
      </div>

      <div class="dashboard-grid">
        <!-- Alertas de estoque crítico -->
        <div class="card card-full">
          <div class="card-header">
            <h3>Alertas de Estoque Crítico</h3>
            <span class="badge badge-danger" id="alertas-count">0</span>
          </div>
          <div class="card-body">
            <div class="table-wrapper">
              <table class="data-table" id="table-alertas">
                <thead>
                  <tr>
                    <th>Modelo</th>
                    <th>Categoria</th>
                    <th>Mínimo</th>
                    <th>Em Reposição</th>
                    <th>Déficit</th>
                    <th>Ag. Triagem</th>
                  </tr>
                </thead>
                <tbody id="tbody-alertas">
                  <tr><td colspan="6" class="empty-row">Carregando...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Movimentações recentes -->
        <div class="card card-full">
          <div class="card-header">
            <h3>Últimas Movimentações</h3>
          </div>
          <div class="card-body">
            <div class="table-wrapper">
              <table class="data-table" id="table-recentes">
                <thead>
                  <tr>
                    <th>Data/Hora</th>
                    <th>Modelo</th>
                    <th>Nº Série</th>
                    <th>Tipo</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="tbody-recentes">
                  <tr><td colspan="5" class="empty-row">Carregando...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ─────────────────────────────────────────────────
         SECTION: CATÁLOGO
    ───────────────────────────────────────────────── -->
    <section id="section-catalogo" class="page-section">
      <div class="section-toolbar">
        <div class="toolbar-left">
          <input type="search" id="search-catalogo" class="input-search" placeholder="Buscar por nome ou categoria..." />
        </div>
        <div class="toolbar-right">
          <button class="btn btn-primary" onclick="Catalogo.abrirModalCriacao()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Novo Item
          </button>
        </div>
      </div>

      <div class="card">
        <div class="card-body p0">
          <div class="table-wrapper">
            <table class="data-table" id="table-catalogo">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Código</th>
                  <th>Modelo / Nome</th>
                  <th>Categoria</th>
                  <th>Mín.</th>
                  <th>Máx.</th>
                  <th>Reposição</th>
                  <th>Triagem</th>
                  <th>Status</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="tbody-catalogo">
                <tr><td colspan="10" class="empty-row">Carregando...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- ─────────────────────────────────────────────────
         SECTION: ENDEREÇOS WMS
    ───────────────────────────────────────────────── -->
    <section id="section-enderecos" class="page-section">
      <div class="section-toolbar">
        <div class="toolbar-left"></div>
        <div class="toolbar-right">
          <button class="btn btn-primary" onclick="Endereco.abrirModalCriacao()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Novo Endereço
          </button>
        </div>
      </div>

      <div class="card">
        <div class="card-body p0">
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Código</th>
                  <th>Descrição</th>
                  <th>Status</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="tbody-enderecos">
                <tr><td colspan="5" class="empty-row">Carregando...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
    <!-- ─────────────────────────────────────────────────
         SECTION: PORTA PALLET
    ───────────────────────────────────────────────── -->

    <section id="section-wms-mapa" class="page-section">
      <div class="card card-full">
        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <h3>Mapa de Ocupação - Porta-Pallet PP01</h3>
            <p class="card-subtitle">Visão frontal de Sessões (Lado 0 e Lado 1).</p>
          </div>
          <div class="wms-legend">
            <span class="badge badge-success">Vazio (0 cx)</span>
            <span class="badge badge-warning">Parcial (1 a 11 cx)</span>
            <span class="badge badge-danger">Cheio (12+ cx)</span>
          </div>
        </div>
        <div class="card-body">
          <div class="rack-scroll-wrapper">
            <div class="rack-grid" id="rack-grid">
              </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ─────────────────────────────────────────────────
         SECTION: EQUIPAMENTOS
    ───────────────────────────────────────────────── -->
    <section id="section-equipamentos" class="page-section">
      <div class="section-toolbar">
        <div class="toolbar-left">
          <select id="filter-status-equip" class="input-select" onchange="Movimentacao.carregarEquipamentos()">
            <option value="">Todos os status</option>
            <option value="reposicao">Reposição</option>
            <option value="ag_triagem">Ag. Triagem</option>
            <option value="em_uso">Em Uso</option>
            <option value="pre_triagem">Pré-Triagem</option>
            <option value="pre_venda">Ag. Venda</option>
            <option value="ag_internalizacao">Ag. Internalização</option>
            <option value="venda">Venda</option>
          </select>
          <input type="search" id="search-equip" class="input-search" placeholder="Buscar por nº série ou patrimônio..." />
        </div>
      </div>

      <div class="card">
        <div class="card-body p0">
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Modelo</th>
                  <th>Nº Série</th>
                  <th>Patrimônio</th>
                  <th>Status</th>
                  <th>Caixa</th>
                  <th>Localização</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="tbody-equipamentos">
                <tr><td colspan="8" class="empty-row">Carregando...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    

    <!-- ─────────────────────────────────────────────────
         SECTION: ENTRADA DE EQUIPAMENTO
    ───────────────────────────────────────────────── -->
    <section id="section-entrada" class="page-section">
      <div class="form-layout">
        <div class="card form-card">
          <div class="card-header">
            <h3>Registrar Entrada de Equipamento</h3>
            <p class="card-subtitle">Preencha os dados da peça física para incorporá-la ao estoque.</p>
          </div>
          <div class="card-body">
            <form id="form-entrada" novalidate>

              <div class="form-section-title">Identificação do Equipamento</div>
              <div class="form-grid-2">
                <div class="form-group">
                  <label for="entrada-catalogo">Modelo (Catálogo) *</label>
                  <select id="entrada-catalogo" class="input-select" required>
                    <option value="">Selecione o modelo...</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="entrada-tipo">Origem da Entrada *</label>
                  <select id="entrada-tipo" class="input-select" required>
                    <option value="entrada_compra">Compra (novo)</option>
                    <option value="entrada_retorno_reparo">Retorno de Reparo Externo</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="entrada-serie">Número de Série *</label>
                  <input type="text" id="entrada-serie" class="input-text" placeholder="Ex: SN-ABC123456" required />
                </div>
                <div class="form-group">
                  <label for="entrada-imobilizado">Patrimônio (Imobilizado) *</label>
                  <input type="text" id="entrada-imobilizado" class="input-text" placeholder="Ex: PAT-00001" required />
                </div>
              </div>

              <div class="form-section-title">Destino Físico (WMS)</div>
              <div class="form-grid-2">
                <div class="form-group">
                  <label for="entrada-endereco">Endereço de Destino *</label>
                  <select id="entrada-endereco" class="input-select" required disabled>
                    <option value="">Carregando endereços...</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="entrada-obs">Observações</label>
                  <input type="text" id="entrada-obs" class="input-text" placeholder="Opcional..." />
                </div>
              </div>

              <div class="form-actions">
                <button type="button" class="btn btn-outline" onclick="Movimentacao.limparFormEntrada()">Limpar</button>
                <button type="submit" class="btn btn-primary btn-lg">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                  Registrar Entrada
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- ─────────────────────────────────────────────────
         SECTION: SAÍDA / MOVIMENTAÇÃO
    ───────────────────────────────────────────────── -->
    <section id="section-saida" class="page-section">
      <div class="form-layout">
        <div class="card form-card">
          <div class="card-header">
            <h3>Saída / Movimentação de Equipamento</h3>
            <p class="card-subtitle">Altere o status de um equipamento: envio para uso, triagem ou baixa.</p>
          </div>
          <div class="card-body">
            <form id="form-saida" novalidate>
              <div class="form-section-title">Localizar Equipamento</div>
              <div class="form-grid-2">
                <div class="form-group">
                  <label for="saida-serie">Número de Série *</label>
                  <div class="input-with-btn">
                    <input type="text" id="saida-serie" class="input-text" placeholder="Digite o nº de série..." />
                    <button type="button" class="btn btn-secondary" onclick="Movimentacao.buscarEquipamentoSaida()">Localizar</button>
                  </div>
                </div>
              </div>

              <!-- Painel de informações do equipamento localizado -->
              <div id="saida-info-panel" class="info-panel" style="display:none">
                <div class="info-grid">
                  <div class="info-item"><span class="info-label">Modelo</span><span class="info-value" id="saida-modelo">—</span></div>
                  <div class="info-item"><span class="info-label">Patrimônio</span><span class="info-value" id="saida-imobilizado">—</span></div>
                  <div class="info-item"><span class="info-label">Status Atual</span><span class="info-value" id="saida-status-atual">—</span></div>
                  <div class="info-item"><span class="info-label">Localização</span><span class="info-value" id="saida-local">—</span></div>
                </div>
              </div>

              <div id="saida-actions-area" style="display:none">
                <div class="form-section-title">Ação de Saída</div>
                <input type="hidden" id="saida-equip-id" />
                <div class="form-grid-2">
                  <div class="form-group">
                    <label for="saida-destino">Destino / Novo Status *</label>
                    <select id="saida-destino" class="input-select" required>
                      <option value="">Selecione a ação...</option>
                      <option value="saida_uso">Enviar para Uso (sai do estoque)</option>
                      <option value="ag_triagem">Enviar para Ag. Triagem (reparo)</option>
                      <option value="venda">Baixar para Venda / Sucata</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="saida-obs">Observações / Motivo</label>
                    <input type="text" id="saida-obs" class="input-text" placeholder="Descreva o motivo..." />
                  </div>
                </div>
                <div class="form-actions">
                  <button type="submit" class="btn btn-primary btn-lg">Confirmar Movimentação</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- ─────────────────────────────────────────────────
         SECTION: CENTRAL DE REPARO
    ───────────────────────────────────────────────── -->
    <section id="section-reparo" class="page-section">
      <div class="reparo-layout">

        <!-- Painel de Modelos Críticos (acima da fila) -->
        <div class="card" id="reparo-criticos-panel" style="display:none">
          <div class="card-header">
            <div>
              <h3>Alertas Críticos — Modelos Abaixo do Mínimo</h3>
              <p class="card-subtitle">Itens que precisam de triagem urgente. Use "Solicitar Lote" para pedir ao almoxarife que desça o pallet.</p>
            </div>
          </div>
          <div class="card-body p0">
            <div class="table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Modelo</th>
                    <th>Categoria</th>
                    <th>Reposição / Mín.</th>
                    <th>Déficit</th>
                    <th>Em Pré-Triagem</th>
                    <th>Solicitação</th>
                    <th>Ação</th>
                  </tr>
                </thead>
                <tbody id="tbody-reparo-criticos">
                  <tr><td colspan="7" class="empty-row">Carregando...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Painel de Solicitações Atendidas (pallets disponibilizados) -->
        <div class="card" id="reparo-atendidas-panel" style="display:none">
          <div class="card-header">
            <div>
              <h3>Pallets Disponibilizados</h3>
              <p class="card-subtitle">Pallets atendidos pelo almoxarife. Clique em um card para bipar o equipamento e iniciar a manutenção.</p>
            </div>
          </div>
          <div class="card-body" id="reparo-solicitacoes-atendidas">
            <div class="empty-row">Carregando...</div>
          </div>
        </div>

        <!-- Tabela de prioridades (apenas itens solicitados pelo técnico) -->
        <div class="card">
          <div class="card-header">
            <div>
              <h3>Fila de Reparo — Meus Itens</h3>
              <p class="card-subtitle">Equipamentos solicitados ativamente por você ou em andamento. Bipe itens nos pallets acima para adicioná-los.</p>
            </div>
            <button class="btn btn-sm btn-outline" onclick="Reparo.carregar()">Atualizar</button>
          </div>
          <div class="card-body p0">
            <div class="table-wrapper">
              <table class="data-table reparo-table" id="table-reparo">
                <thead>
                  <tr>
                    <th>Prioridade</th>
                    <th>Modelo</th>
                    <th>Nº Série</th>
                    <th>Reposição / Mín.</th>
                    <th>Status Reparo</th>
                    <th>Tempo Acum.</th>
                    <th>Localização</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="tbody-reparo">
                  <tr><td colspan="8" class="empty-row">Carregando...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Painel de controle de reparo (exibido ao selecionar um item) -->
        <div class="card reparo-control-panel" id="reparo-control-panel" style="display:none">
          <div class="card-header">
            <div>
              <h3 id="reparo-panel-titulo">Controle de Reparo</h3>
              <p class="card-subtitle" id="reparo-panel-sub">Selecione um item na tabela para iniciar.</p>
            </div>
            <button class="icon-btn" onclick="Reparo.fecharPainel()" title="Fechar painel">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
          </div>
          <div class="card-body">

            <!-- Informações do equipamento -->
            <div class="reparo-info-grid">
              <div class="info-item"><span class="info-label">Modelo</span><span class="info-value" id="rp-modelo">—</span></div>
              <div class="info-item"><span class="info-label">Nº Série</span><span class="info-value" id="rp-serie">—</span></div>
              <div class="info-item"><span class="info-label">Patrimônio</span><span class="info-value" id="rp-imobilizado">—</span></div>
              <div class="info-item"><span class="info-label">Localização</span><span class="info-value" id="rp-local">—</span></div>
            </div>

            <!-- Timer -->
            <div class="reparo-timer-block">
              <div class="timer-display" id="timer-display">00:00:00</div>
              <div class="timer-label">Tempo Trabalhado (sessão atual + acumulado)</div>
            </div>

            <!-- Controles de workflow -->
            <div class="reparo-controls" id="reparo-controls">
              <button class="btn btn-success btn-reparo" id="btn-iniciar" onclick="Reparo.iniciar()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                Iniciar
              </button>
              <button class="btn btn-warning btn-reparo" id="btn-pausar" onclick="Reparo.pausar()" style="display:none">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                Pausar
              </button>
              <button class="btn btn-danger btn-reparo" id="btn-finalizar" onclick="Reparo.abrirModalFinalizar()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
                Finalizar
              </button>
            </div>

            <!-- Descrição / diagnóstico -->
            <div class="form-grid-1" style="margin-top:1.5rem">
              <div class="form-group">
                <label for="rp-problema">Descrição do Problema</label>
                <textarea id="rp-problema" class="input-textarea" rows="2" placeholder="Descreva o problema observado..."></textarea>
              </div>
              <div class="form-group">
                <label for="rp-diagnostico">Diagnóstico Técnico</label>
                <textarea id="rp-diagnostico" class="input-textarea" rows="2" placeholder="Diagnóstico e ações realizadas..."></textarea>
              </div>
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="Reparo.salvarNotas()">Salvar Notas</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ─────────────────────────────────────────────────
         SECTION: RECEBIMENTO
    ───────────────────────────────────────────────── -->
    <section id="section-recebimento" class="page-section">
      <!-- Sub-tabs -->
      <div class="section-toolbar">
        <div class="toolbar-left">
          <div class="tab-group" id="receb-tabs">
            <button class="btn btn-primary tab-btn active" data-tab="receb-catalogacao" onclick="Recebimento.trocarAba('catalogacao')">
              Entrada e Catalogação
            </button>
            <button class="btn btn-outline tab-btn" data-tab="receb-montar" onclick="Recebimento.trocarAba('montar')">
              Montar Pallet / Caixa
            </button>
          </div>
        </div>
        <div class="toolbar-right">
          <button class="btn btn-sm btn-outline" onclick="Recebimento.carregar()">Atualizar</button>
        </div>
      </div>

      <!-- Aba 1: Entrada e Catalogação (usa fluxo de entrada com tipo entrada_recebimento) -->
      <div id="receb-catalogacao" class="receb-tab-content">
        <div class="form-layout">
          <div class="card form-card">
            <div class="card-header">
              <h3>Catalogar Item Recebido</h3>
              <p class="card-subtitle">Registre o item chegado de outra loja e destine-o à prateleira correta.</p>
            </div>
            <div class="card-body">
              <form id="form-recebimento" novalidate>

                <div class="form-section-title">Identificação do Equipamento</div>
                <div class="form-grid-2">
                  <div class="form-group">
                    <label for="receb-catalogo">Modelo (Catálogo) *</label>
                    <select id="receb-catalogo" class="input-select" required>
                      <option value="">Selecione o modelo...</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="receb-destino-inicial">Prateleira de Destino *</label>
                    <select id="receb-destino-inicial" class="input-select" required>
                      <option value="pre_triagem">Pré-Triagem (aguarda avaliação)</option>
                      <option value="pre_venda">Pré-Venda (para venda / sucata)</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="receb-serie">Número de Série *</label>
                    <input type="text" id="receb-serie" class="input-text" placeholder="Ex: SN-ABC123456" required />
                  </div>
                  <div class="form-group">
                    <label for="receb-imobilizado">Patrimônio (Imobilizado) *</label>
                    <input type="text" id="receb-imobilizado" class="input-text" placeholder="Ex: PAT-00001" required />
                  </div>
                </div>

                <div class="form-section-title">Destino Físico (Prateleira de Recebimento)</div>
                <div class="info-panel" style="margin-bottom:1rem">
                  <div class="info-grid">
                    <div class="info-item">
                      <span class="info-label">Pré-Triagem</span>
                      <span class="info-value"><code id="receb-addr-pretriagem">Carregando...</code></span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">Pré-Venda</span>
                      <span class="info-value"><code id="receb-addr-prevenda">Carregando...</code></span>
                    </div>
                  </div>
                </div>

                <div class="form-grid-1">
                  <div class="form-group">
                    <label for="receb-obs">Observações / Condição do Item</label>
                    <input type="text" id="receb-obs" class="input-text" placeholder="Ex: Tela trincada, HD ausente..." />
                  </div>
                </div>

                <div class="form-actions">
                  <button type="button" class="btn btn-outline" onclick="Recebimento.limparFormCatalogacao()">Limpar</button>
                  <button type="submit" class="btn btn-primary btn-lg">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                    Registrar Item Recebido
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Aba 2: Montar Pallet / Caixa (transferência em lote) -->
      <div id="receb-montar" class="receb-tab-content" style="display:none">
        <div class="card">
          <div class="card-header">
            <div>
              <h3>Montar Pallet / Caixa</h3>
              <p class="card-subtitle">Selecione itens das prateleiras de pré-triagem/pré-venda e consolide-os em uma caixa definitiva.</p>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <select id="montar-filtro-status" class="input-select" onchange="Recebimento.carregarPrateleiras()" style="width:auto">
                <option value="pre_triagem">Pré-Triagem</option>
                <option value="pre_venda">Pré-Venda</option>
              </select>
            </div>
          </div>
          <div class="card-body p0">
            <div class="table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th style="width:40px">
                      <input type="checkbox" id="montar-check-all" onchange="Recebimento.selecionarTodos(this.checked)" title="Selecionar todos" />
                    </th>
                    <th>Modelo</th>
                    <th>Nº Série</th>
                    <th>Patrimônio</th>
                    <th>Status</th>
                    <th>Observações</th>
                  </tr>
                </thead>
                <tbody id="tbody-prateleiras">
                  <tr><td colspan="6" class="empty-row">Carregando...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="card-body" style="border-top:1px solid var(--c-border)">
            <div id="montar-destino-info" style="margin-bottom:12px">
              <span class="badge badge-warning" style="font-size:13px;padding:6px 12px">
                Destino: Ag. Triagem (criará reparos automaticamente)
              </span>
            </div>
            <div class="form-grid-2">
              <div class="form-group" id="montar-endereco-group">
                <label>Pallet de Destino * <span style="font-size:11px;color:var(--c-text-muted)">(uma caixa será criada automaticamente)</span></label>
                <select id="montar-pallet-destino" class="input-select">
                  <option value="">Selecione o pallet...</option>
                </select>
              </div>
              <div class="form-group">
                <label>Observações</label>
                <input type="text" id="montar-obs" class="input-text" placeholder="Opcional..." />
              </div>
            </div>
            <div class="form-actions">
              <span id="montar-count-badge" class="badge badge-info">0 itens selecionados</span>
              <button class="btn btn-primary btn-lg" onclick="Recebimento.confirmarMontarPallet()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                Transferir Selecionados
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ─────────────────────────────────────────────────
         SECTION: SOLICITAÇÕES DE ALMOXARIFADO
    ───────────────────────────────────────────────── -->
    <section id="section-solicitacoes" class="page-section">
      <div class="section-toolbar">
        <div class="toolbar-left">
          <select id="filter-sol-status" class="input-select" onchange="Solicitacoes.carregar()">
            <option value="">Todas as solicitações</option>
            <option value="pendente" selected>Pendentes</option>
            <option value="em_andamento">Em Andamento</option>
            <option value="atendida">Atendidas</option>
            <option value="cancelada">Canceladas</option>
          </select>
        </div>
        <div class="toolbar-right">
          <button class="btn btn-sm btn-outline" onclick="Solicitacoes.carregar()">Atualizar</button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3>Solicitações de Descida de Pallet</h3>
          <p class="card-subtitle">Pedidos do técnico de reparo para o almoxarife descer um lote de determinado modelo.</p>
        </div>
        <div class="card-body p0">
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Modelo</th>
                  <th>Categoria</th>
                  <th>Estoque Atual / Mín.</th>
                  <th>Déficit</th>
                  <th>Status</th>
                  <th>Solicitado em</th>
                  <th>Observações</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="tbody-solicitacoes">
                <tr><td colspan="9" class="empty-row">Carregando...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- ─────────────────────────────────────────────────
         SECTION: INTERNALIZAÇÃO
    ───────────────────────────────────────────────── -->
    <section id="section-internalizacao" class="page-section">
      <div class="section-toolbar">
        <div class="toolbar-left">
          <span style="font-size:13px;color:var(--c-text-muted)">
            Equipamentos reparados aguardando validação e alocação física no WMS.
          </span>
        </div>
        <div class="toolbar-right">
          <button class="btn btn-sm btn-outline" onclick="Internalizacao.carregar()">Atualizar</button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3>Aguardando Internalização</h3>
          <p class="card-subtitle">
            Equipamentos finalizados pelo técnico como "bom para uso". O administrador valida e aloca no WMS.
          </p>
        </div>
        <div class="card-body p0">
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Modelo</th>
                  <th>Nº Série</th>
                  <th>Patrimônio</th>
                  <th>Filial Atual</th>
                  <th>Finalizado em</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="tbody-internalizacao">
                <tr><td colspan="6" class="empty-row">Carregando...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

  </div><!-- /#main -->
</div><!-- /#app -->

<!-- ═══════════════════════════════════════════════════════
     MODAL GENÉRICO
══════════════════════════════════════════════════════════ -->
<div id="modal-overlay" class="modal-overlay" onclick="Modal.fecharSeFora(event)">
  <div class="modal" id="modal-box" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h3 id="modal-titulo">Título</h3>
      <button class="icon-btn modal-close" onclick="Modal.fechar()" title="Fechar">&times;</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
    <div class="modal-footer" id="modal-footer"></div>
  </div>
</div>



<!-- ═══════════════════════════════════════════════════════
     TOAST CONTAINER
══════════════════════════════════════════════════════════ -->
<div id="toast-container" aria-live="polite"></div>

<!-- ═══════════════════════════════════════════════════════
     SCRIPTS (ordem importa: api → app → módulos)
══════════════════════════════════════════════════════════ -->
<script src="js/api.js"></script>
<script src="js/app.js"></script>
<script src="js/catalogo.js"></script>
<script src="js/endereco.js"></script>
<script src="js/movimentacao.js"></script>
<script src="js/recebimento.js"></script>
<script src="js/solicitacoes.js"></script>
<script src="js/reparo.js"></script>
<script src="js/internalizacao.js"></script>
<script src="js/wms-mapa.js"></script>

</body>
</html>
